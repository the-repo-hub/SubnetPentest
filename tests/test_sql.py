from base import HostsDataTable, Base
from sqlalchemy import create_engine, select
import unittest
from sqlalchemy.orm import Session
import os


class SQLTestCase(unittest.TestCase):

    base_name = 'test.db'
    engine = create_engine(f'sqlite:///{base_name}')
    base_session = Session(bind=engine)
    host_create = '123.45.67.89'
    #host_edit = ''

    @classmethod
    def setUpClass(cls):
        Base.metadata.create_all(cls.engine)

    def test_host_creation(self):
        host1 = HostsDataTable(host=self.host_create, port=1723)
        self.base_session.add(host1)
        self.base_session.commit()
        host_from_base = self.base_session.query(HostsDataTable).where(HostsDataTable.host == self.host_create).first()
        self.assertEqual(self.host_create, host_from_base.host)
        self.assertTrue(host_from_base.last_update)

    @classmethod
    def tearDownClass(cls):
        os.remove(cls.base_name)
