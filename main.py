import socket
from typing import List

import requests
from bs4 import BeautifulSoup


class Backend:
    ua = {
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.159 Safari/537.36'
    }
    timeout = 10
    file = None
    name = None

    @classmethod
    def host_check(cls, host, port):
        sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        sock.settimeout(cls.timeout)
        result = sock.connect_ex((host, port))
        if result == 0:
            print(f"{host}:{port} is open")
            with open(f'{cls.name}.txt', 'a') as opened:
                opened.write(f'{host}\n')
        else:
            print(f"{host}:{port} is closed")
        sock.close()

    @classmethod
    def filter_ipv4(cls, ip_ranges: List[str]) -> List[str]:
        for num, ip_range in enumerate(ip_ranges):
            if ':' in ip_range:
                return ip_ranges[:num]
        return ip_ranges

    @classmethod
    def get_ip_pull(cls, url: str) -> List[str]:
        response = requests.get(url, headers=cls.ua)
        text = BeautifulSoup(response.text, 'html.parser').find('pre').text
        cls.name = BeautifulSoup(response.text, 'html.parser').find('article').find('h2').text
        return cls.filter_ipv4(text.split('\n')[:-1])

    @classmethod
    def run(cls):
        pull = cls.get_ip_pull('https://suip.biz/?act=all-country-ip&city=Aleksandrovac')


